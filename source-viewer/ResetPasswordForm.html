<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>ResetPasswordForm</title>
</head>
<body>
<h1>ResetPasswordForm</h1>
<h2>src/components/component-instance/ResetPasswordForm.jsx</h2>
<pre>
import PropTypes from &quot;prop-types&quot;;
import React, { useState, useEffect, useRef } from &quot;react&quot;;
import clsx from &quot;clsx&quot;;
import style from './ResetPasswordForm.module.scss'

import { customer_reset_password } from &quot;../../api/customer&quot;
import { createValidator } from &quot;../../lib/validator&quot;

const ResetPasswordForm = ({
    routingTable,
    element,
    elementProps,
    mode,
    ...props
}) =&gt; {

    const [, forceUpdate] = useState();
    const resetPasswordValidator = useRef(createValidator())

    // URL params state
    const [token, setToken] = useState('')
    const [email, setEmail] = useState('')
    const [isValidLink, setIsValidLink] = useState(true)

    // Form state
    const [newPassword, setNewPassword] = useState('')
    const [confirmPassword, setConfirmPassword] = useState('')
    const [viewPassword, setViewPassword] = useState(false)
    const [viewConfirmPassword, setViewConfirmPassword] = useState(false)

    // Submit state
    const [isSubmitting, setIsSubmitting] = useState(false)
    const [submitMessage, setSubmitMessage] = useState({ type: '', text: '' })

    // Parse URL params on mount
    useEffect(() =&gt; {
        const urlSearchParams = new URLSearchParams(window.location.search);
        const tokenParam = urlSearchParams.get('token') || '';
        const emailParam = urlSearchParams.get('email') || '';

        if (!tokenParam || !emailParam) {
            setIsValidLink(false)
            return
        }

        setToken(tokenParam)
        setEmail(emailParam)

    }, []);

    const handleResetPassword = () =&gt; {
        if (!resetPasswordValidator?.current?.allValid()) {
            resetPasswordValidator?.current?.showMessages()
            forceUpdate(new Date())
            return
        }

        if (newPassword !== confirmPassword) {
            setSubmitMessage({ type: 'error', text: '密碼不一致' })
            return
        }

        setIsSubmitting(true)
        setSubmitMessage({ type: '', text: '' })

        customer_reset_password({ 'token':token, 'password': newPassword }).then(res =&gt; {
            setSubmitMessage({ type: 'success', text: '密碼重設成功！即將跳轉至登入頁面...' })
            setIsSubmitting(false)
            // Redirect to login page after 2 seconds
            setTimeout(() =&gt; {
                window.location.href = `/${routingTable?.['customer_login_route'] || 'login'}`
            }, 2000)
        }).catch(err =&gt; {
            setSubmitMessage({ type: 'error', text: err?.response?.data?.message || '密碼重設失敗，請稍後再試' })
            setIsSubmitting(false)
        })
    }

    // Invalid link view
    if (!isValidLink) {
        return (
            &lt;div
                {...elementProps}
                className={clsx(style['重設密碼表單'], '重設密碼表單', elementProps?.className)}
            &gt;
                &lt;div className={clsx(style['標題框'], '標題框')}&gt;
                    &lt;h3 className={clsx(style['標題'], '標題')}&gt;重設密碼&lt;/h3&gt;
                &lt;/div&gt;
                &lt;div className={clsx(style['錯誤訊息框'], '錯誤訊息框')}&gt;
                    &lt;p className={clsx(style['錯誤訊息'], '錯誤訊息')}&gt;
                        無效的重設連結，請重新申請密碼重設。
                    &lt;/p&gt;
                    &lt;a
                        className={clsx(style['返回登入連結'], '返回登入連結')}
                        href={`/${routingTable?.['customer_login_route'] || 'login'}`}
                    &gt;
                        返回登入頁面
                    &lt;/a&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        )
    }

    return (
        &lt;form
            {...elementProps}
            className={clsx(style['重設密碼表單'], '重設密碼表單', elementProps?.className)}
        &gt;
            &lt;div className={clsx(style['標題框'], '標題框')}&gt;
                &lt;h3 className={clsx(style['標題'], '標題')}&gt;重設密碼&lt;/h3&gt;
            &lt;/div&gt;

            {/* Display target email */}
            &lt;div className={clsx(style['帳號顯示框'], '帳號顯示框')}&gt;
                &lt;label className={clsx(style['帳號-標籤'], '帳號-標籤')}&gt;帳號：&lt;/label&gt;
                &lt;span className={clsx(style['帳號-顯示'], '帳號-顯示')}&gt;{email}&lt;/span&gt;
            &lt;/div&gt;

            {/* New Password */}
            &lt;div className={clsx(style['密碼框'], '密碼框')}&gt;
                &lt;label className={clsx(style['密碼-標籤'], '密碼-標籤')}&gt;新密碼：&lt;/label&gt;
                &lt;div className={clsx(style['密碼輸入框'], '密碼輸入框')}&gt;
                    &lt;input
                        className={clsx(style['密碼-輸入'], '密碼-輸入')}
                        type={viewPassword ? 'text' : 'password'}
                        name=&quot;new-password&quot;
                        placeholder=&quot;請輸入新密碼&quot;
                        value={newPassword}
                        onChange={(e) =&gt; setNewPassword(e.target.value)}
                        onBlur={() =&gt; {
                            resetPasswordValidator.current.showMessageFor(&quot;newPassword&quot;)
                            forceUpdate(new Date())
                        }}
                    /&gt;
                    &lt;button
                        className={clsx(style['顯示密碼-按鈕'], '顯示密碼-按鈕')}
                        type=&quot;button&quot;
                        onClick={() =&gt; setViewPassword(!viewPassword)}
                    &gt;
                        &lt;i className={clsx(style['顯示密碼-圖標'], '顯示密碼-圖標', viewPassword ? &quot;fa fa-solid fa-eye-slash&quot; : &quot;fa fa-solid fa-eye&quot;)} /&gt;
                    &lt;/button&gt;
                &lt;/div&gt;
                {resetPasswordValidator.current.message(&quot;newPassword&quot;, newPassword, &quot;required|min:8&quot;, {messages:{'min':'密碼至少需為8位'}, className:'不合規提示'})}
            &lt;/div&gt;

            {/* Confirm Password */}
            &lt;div className={clsx(style['密碼框'], '密碼框')}&gt;
                &lt;label className={clsx(style['密碼-標籤'], '密碼-標籤')}&gt;確認新密碼：&lt;/label&gt;
                &lt;div className={clsx(style['密碼輸入框'], '密碼輸入框')}&gt;
                    &lt;input
                        className={clsx(style['密碼-輸入'], '密碼-輸入')}
                        type={viewConfirmPassword ? 'text' : 'password'}
                        name=&quot;confirm-password&quot;
                        placeholder=&quot;請再次輸入新密碼&quot;
                        value={confirmPassword}
                        onChange={(e) =&gt; setConfirmPassword(e.target.value)}
                        onBlur={() =&gt; {
                            resetPasswordValidator.current.showMessageFor(&quot;confirmPassword&quot;)
                            forceUpdate(new Date())
                        }}
                    /&gt;
                    &lt;button
                        className={clsx(style['顯示密碼-按鈕'], '顯示密碼-按鈕')}
                        type=&quot;button&quot;
                        onClick={() =&gt; setViewConfirmPassword(!viewConfirmPassword)}
                    &gt;
                        &lt;i className={clsx(style['顯示密碼-圖標'], '顯示密碼-圖標', viewConfirmPassword ? &quot;fa fa-solid fa-eye-slash&quot; : &quot;fa fa-solid fa-eye&quot;)} /&gt;
                    &lt;/button&gt;
                &lt;/div&gt;
                {resetPasswordValidator.current.message(&quot;confirmPassword&quot;, confirmPassword, `required|in:${newPassword}`, {messages:{'in':'密碼不相符'}, className:'不合規提示'})}
            &lt;/div&gt;

            {/* Message display */}
            {submitMessage.text &amp;&amp; (
                &lt;div className={clsx(
                    style['訊息框'],
                    '訊息框',
                    submitMessage.type === 'success' ? style['成功'] : style['錯誤']
                )}&gt;
                    {submitMessage.text}
                &lt;/div&gt;
            )}

            {/* Submit button */}
            &lt;div className={clsx(style['送出按鈕框'], '送出按鈕框')}&gt;
                &lt;button
                    className={clsx(style['送出按鈕'], '送出按鈕')}
                    type=&quot;button&quot;
                    onClick={handleResetPassword}
                    disabled={isSubmitting}
                &gt;
                    {isSubmitting ? '處理中...' : '重設密碼'}
                &lt;/button&gt;
            &lt;/div&gt;

            {/* Back to login link */}
            {/* &lt;div className={clsx(style['連結框'], '連結框')}&gt;
                &lt;a
                    className={clsx(style['返回登入連結'], '返回登入連結')}
                    href={`/${routingTable?.['customer_login_route'] || 'login'}`}
                &gt;
                    返回登入頁面
                &lt;/a&gt;
            &lt;/div&gt; */}
        &lt;/form&gt;
    )
};

ResetPasswordForm.propTypes = {
};

export default ResetPasswordForm;
</pre>
<h2>src/components/component-instance/ResetPasswordForm.module.scss</h2>
<pre>.重設密碼表單 {
    background: #ffffff;
    padding: 24px;
    border-radius: 8px;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
    width: 320px;
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.標題框 {
    text-align: center;
}

.標題 {
    font-size: 20px;
    color: #333;
    margin: 0;
}

.帳號顯示框 {
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding: 12px;
    background-color: #f5f5f5;
    border-radius: 4px;
}

.帳號-標籤 {
    font-size: 14px;
    color: #666;
}

.帳號-顯示 {
    font-size: 14px;
    color: #333;
    font-weight: 500;
    word-break: break-all;
}

.密碼框 {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.密碼-標籤 {
    font-size: 14px;
    color: #333;
}

.密碼輸入框 {
    position: relative;
    display: flex;
    align-items: center;
    width: 100%;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 5px;
    background: white;
    box-sizing: border-box;
}

.密碼-輸入 {
    flex: 1;
    padding: 10px;
    border: none;
    font-size: 14px;
    outline: none;
    background: transparent;
}

.顯示密碼-按鈕 {
    background: none;
    border: none;
    cursor: pointer;
    padding: 5px;
}

.顯示密碼-圖標 {
    font-size: 16px;
    color: #666;
}

.訊息框 {
    font-size: 13px;
    padding: 10px 12px;
    border-radius: 4px;
    text-align: center;
}

.訊息框.成功 {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.訊息框.錯誤 {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.送出按鈕框 {
    display: flex;
    justify-content: center;
}

.送出按鈕 {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    width: 100%;
    transition: background-color 0.2s;
}

.送出按鈕:hover:not(:disabled) {
    background-color: #0056b3;
}

.送出按鈕:disabled {
    background-color: #6c757d;
    cursor: not-allowed;
}

.連結框 {
    display: flex;
    justify-content: center;
}

.返回登入連結 {
    font-size: 14px;
    color: #007bff;
    cursor: pointer;
    text-decoration: none;
}

.返回登入連結:hover {
    text-decoration: underline;
}

.錯誤訊息框 {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    padding: 20px;
}

.錯誤訊息 {
    font-size: 14px;
    color: #721c24;
    text-align: center;
    margin: 0;
}
</pre>
</body>
</html>