<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>customer_login_form</title>
</head>
<body>
<h1>customer_login_form</h1>
<h2>src/components/component-instance/LoginForm.jsx</h2>
<pre>
import PropTypes from &quot;prop-types&quot;;
import React, { Fragment, useState, useEffect, useRef } from &quot;react&quot;;
import clsx from &quot;clsx&quot;;
import style from './LoginForm.module.scss'

import { useAppSelector, useAppDispatch  } from &quot;@/redux/hooks&quot;;

import { setCustomer } from '../../redux/slices/customer-slice'

import { customer_general_login, customer_forgot_password } from &quot;../../api/customer&quot;
import Cookies from &quot;js-cookie&quot;;
import { createValidator } from &quot;../../lib/validator&quot;
import MyIcon from &quot;./my-icons/MyIcon&quot;

const FORGOT_PASSWORD_COOLDOWN = 60; // seconds

// import route_names from &quot;../../route_names&quot;;

// import { useSearchParams } from 'next/navigation';

// import {  useRouter } from 'next/navigation';

const LoginForm = ({  
    // node,  
    // mode, 
    // actions, 
    // update, children, routingTable, ...props

    routingTable,
    element, 
    elementProps,
    mode,
    ...props


}) =&gt; {
    


    const dispatch = useAppDispatch();
    // const searchParams = useSearchParams()
    // const router = useRouter()
    // const websiteEditorState = useAppSelector((state) =&gt; state.website_editor);



    // const [width, setWidth] = useState('')
    // const [isHover, setIsHover] = useState(false)
    
    const [searchParams, setSearchParams] = useState({ redirect: null, });


    const [awaitSubmitButton, setAwaitSubmitButton] = useState(false)
        

    const [loginData, setLoginData] = useState({email:Cookies.get('customer_me'),password:''})
    const [viewPassword, setViewPassword] = useState(false)
    
    const [rememberMe,setRememberMe] = useState(Cookies.get('customer_me')?true:false)

    const [, forceUpdate] = useState();
    const loginFormValidator = useRef(createValidator())
    const forgotPasswordValidator = useRef(createValidator())

    // Forgot password state
    const [showForgotPassword, setShowForgotPassword] = useState(false)
    const [forgotPasswordEmail, setForgotPasswordEmail] = useState('')
    const [forgotPasswordLoading, setForgotPasswordLoading] = useState(false)
    const [forgotPasswordCooldown, setForgotPasswordCooldown] = useState(0)
    const [forgotPasswordMessage, setForgotPasswordMessage] = useState({ type: '', text: '' })
    
    const [submitMessage, setSubmitMessage] = useState({ type: '', text: '' })
    

    useEffect(() =&gt; {
        const urlSearchParams = new URLSearchParams(window.location.search);
        const redirect = urlSearchParams.get('redirect') || '';
        setSearchParams({ redirect });
    }, []);

    // Cooldown timer effect
    useEffect(() =&gt; {
        if (forgotPasswordCooldown &gt; 0) {
            const timer = setTimeout(() =&gt; {
                setForgotPasswordCooldown(forgotPasswordCooldown - 1)
            }, 1000)
            return () =&gt; clearTimeout(timer)
        }
    }, [forgotPasswordCooldown])





    const handleLogin = (event)=&gt;{
        setSubmitMessage({ type: '', text: '' })
        if(!loginFormValidator?.current?.allValid()){
            setSubmitMessage({ type: 'error', text: '資料有誤' })
            loginFormValidator?.current?.showMessages()
            forceUpdate(new Date())
            return
        }

        setAwaitSubmitButton(true)
        customer_general_login(loginData).then(res=&gt;{
            console.log(res.data)
            dispatch(setCustomer(res.data.customer))
            localStorage.setItem(&quot;customer&quot;, JSON.stringify(res?.data?.customer));
            var inOneDay = new Date(new Date().getTime() + 1 * 24 * 60 * 60 *1000)
            Cookies.set('customer_access_token', res.data.customer_access_token, {expires: inOneDay})
            if(rememberMe){
                Cookies.set('customer_me', loginData.email)
            }else{
                Cookies.remove('customer_me')
            }
            // setAwaitSubmitButton(false)
            window.location.href = searchParams?.redirect||'/'
            // router.push(searchParams.get('redirect')||'/')
        }).catch(err=&gt;{
            setSubmitMessage({ type: 'error', text: '登入失敗 請重試' })
            setAwaitSubmitButton(false)
        })
    }

    const handleForgotPassword = () =&gt; {
        if (!forgotPasswordValidator?.current?.allValid()) {
            forgotPasswordValidator?.current?.showMessages()
            forceUpdate(new Date())
            return
        }

        if (forgotPasswordCooldown &gt; 0) {
            return
        }

        setForgotPasswordLoading(true)
        setForgotPasswordMessage({ type: '', text: '' })

        customer_forgot_password({'email':forgotPasswordEmail}).then(res =&gt; {
            setForgotPasswordMessage({ type: 'success', text: '重設密碼連結已寄送至您的信箱' })
            setForgotPasswordCooldown(FORGOT_PASSWORD_COOLDOWN)
            setForgotPasswordLoading(false)
        }).catch(err =&gt; {
            setForgotPasswordMessage({ type: 'error', text: err?.response?.data?.message || '發送失敗，請稍後再試' })
            setForgotPasswordLoading(false)
        })
    }

    const toggleForgotPassword = () =&gt; {
        setShowForgotPassword(!showForgotPassword)
        setForgotPasswordMessage({ type: '', text: '' })
        if (!showForgotPassword) {
            setForgotPasswordEmail(loginData.email || '')
        }
    }




    return (
        &lt;form
            {...elementProps}
        &gt;
            
            &lt;div className={clsx(style['標題框'], '標題框')}&gt;
                &lt;h3 className={clsx(style['標題'], '標題')}&gt;顧客登入&lt;/h3&gt;
            &lt;/div&gt;

            
            

            {/* Forgot Password Section */}
            {showForgotPassword ? (
                &lt;div className={clsx(style['忘記密碼框'], '忘記密碼框')}&gt;
                    &lt;label className={clsx(style['忘記密碼-標籤'], '忘記密碼-標籤')}&gt;輸入您的電子郵件以重設密碼：&lt;/label&gt;
                    &lt;input
                        className={clsx(style['忘記密碼-輸入'], '忘記密碼-輸入')}
                        type=&quot;email&quot;
                        placeholder=&quot;電子郵件 Email&quot;
                        value={forgotPasswordEmail}
                        onChange={(e) =&gt; setForgotPasswordEmail(e.target.value)}
                        onBlur={() =&gt; {
                            forgotPasswordValidator.current.showMessageFor(&quot;forgotEmail&quot;)
                            forceUpdate(new Date())
                        }}
                    /&gt;
                    {forgotPasswordValidator.current.message(&quot;forgotEmail&quot;, forgotPasswordEmail, &quot;required|email&quot;)}

                    {forgotPasswordMessage.text &amp;&amp; (
                        &lt;div className={clsx(
                            style['忘記密碼-訊息'],
                            '忘記密碼-訊息',
                            forgotPasswordMessage.type === 'success' ? style['成功'] : style['錯誤']
                        )}&gt;
                            {forgotPasswordMessage.text}
                        &lt;/div&gt;
                    )}

                    &lt;button
                        className={clsx(style['忘記密碼-送出按鈕'], '忘記密碼-送出按鈕')}
                        type=&quot;button&quot;
                        onClick={handleForgotPassword}
                        disabled={forgotPasswordLoading || forgotPasswordCooldown &gt; 0}
                    &gt;
                        {forgotPasswordLoading
                            ? '發送中...'
                            : forgotPasswordCooldown &gt; 0
                                ? `請等待 ${forgotPasswordCooldown} 秒`
                                : '發送重設連結'}
                    &lt;/button&gt;
                &lt;/div&gt;
            )
            :
            &lt;Fragment&gt;
                &lt;div className={clsx(style['電子郵件框'], '電子郵件框')}&gt;
                    &lt;label className={clsx(style['電子郵件-標籤'], '電子郵件-標籤')}&gt;電子郵件：&lt;/label&gt;
                    &lt;input
                        className={clsx(style['電子郵件-輸入'], '電子郵件-輸入')}
                        type=&quot;email&quot;
                        name=&quot;customer-email&quot;
                        placeholder=&quot;電子郵件 Email&quot;
                        value={loginData.email}
                        onChange={(e)=&gt;{
                            setLoginData({...loginData, email:e.target.value})
                        }}
                        onBlur={() =&gt; {
                            loginFormValidator.current.showMessageFor(&quot;email&quot;)
                            forceUpdate(new Date())
                        }}
                    /&gt;
                    {loginFormValidator.current.message(&quot;email&quot;, loginData.email, &quot;required|email&quot;)}
                &lt;/div&gt;
            
                &lt;div className={clsx(style['密碼框'], '密碼框')}&gt;
                    &lt;label className={clsx(style['密碼-標籤'], '密碼-標籤')}&gt;密碼：&lt;/label&gt;
                    &lt;div className={clsx(style['密碼輸入框'], '密碼輸入框')}&gt;
                        &lt;input
                            className={clsx(style['密碼-輸入'], '密碼-輸入')}
                            type={viewPassword?'text':'password'}
                            name=&quot;customer-password&quot;
                            placeholder=&quot;密碼 Password&quot;
                            onChange={(e)=&gt;{
                                setLoginData({...loginData, password:e.target.value})
                            }}
                            onBlur={() =&gt; {
                                loginFormValidator.current.showMessageFor(&quot;password&quot;)
                                forceUpdate(new Date());
                            }}
                        /&gt;
                        &lt;button className={clsx(style['顯示密碼-按鈕'], '顯示密碼-按鈕')} type=&quot;button&quot; onClick={()=&gt;{setViewPassword(!viewPassword)}}&gt;
                            &lt;MyIcon name={viewPassword ? 'eye-slash' : 'eye'} className={clsx(style['顯示密碼-圖標'], '顯示密碼-圖標')} /&gt;
                        &lt;/button&gt;
                    &lt;/div&gt;
                    {loginFormValidator.current.message(&quot;password&quot;, loginData.password, &quot;required&quot;)}
                &lt;/div&gt;
                


                &lt;div className={clsx(style['記住我框'], '記住我框')}&gt;
                    &lt;label  className={clsx(style['記住我-標籤'], '記住我-標籤')}&gt;記住我&lt;/label&gt;
                    &lt;input 
                        className={clsx(style['記住我-勾選'], '記住我-勾選')}
                        type=&quot;checkbox&quot; 
                        checked={rememberMe}
                        onChange={(e)=&gt;{
                            setRememberMe(!rememberMe)
                        }}/&gt;
                    
                    &lt;button
                            className={clsx(style['忘記密碼按鈕'], '忘記密碼按鈕')}
                            type=&quot;button&quot;
                            onClick={toggleForgotPassword}
                        &gt;
                            忘記密碼？
                    &lt;/button&gt;
                &lt;/div&gt;
            &lt;/Fragment&gt;
            }

            
            &lt;div className={clsx(style['登入註冊框'], '登入註冊框')}&gt;
                &lt;div className={clsx(style['登入按鈕框'], '登入按鈕框')}&gt;
                    {
                        showForgotPassword ?
                        &lt;button
                            className={clsx(style['返回登入按鈕'], '返回登入按鈕')}
                            type=&quot;button&quot;
                            onClick={toggleForgotPassword}
                        &gt;
                            返回登入
                        &lt;/button&gt;
                        :
                        &lt;button  className={clsx(style['登入按鈕'], '登入按鈕', awaitSubmitButton?`${style['隱藏']} 隱藏`:'')} type=&quot;button&quot;  onClick={handleLogin}&gt;
                            登入 Login
                        &lt;/button&gt;
                    }

                    
                &lt;/div&gt;

                &lt;div className={clsx(style['註冊連結框'], '註冊連結框')}&gt;
                    &lt;a className={clsx(style['註冊連結'], '註冊連結')} href={`/${routingTable?.['customer_register_route']}`} &gt;註冊&lt;/a&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            
            {/* Message display */}
            {submitMessage.text &amp;&amp; (
                &lt;div className={clsx(
                    style['訊息框'],
                    '訊息框',
                    submitMessage.type === 'success' ? style['成功'] : style['錯誤'],
                    submitMessage.type === 'success' ? '成功' : '錯誤'
                )}&gt;
                    {submitMessage.text}
                &lt;/div&gt;
            )}


        &lt;/form&gt;

    )
};

LoginForm.propTypes = {
};

export default LoginForm;




</pre>
<h2>src/components/component-instance/LoginForm.module.scss</h2>
<pre>// @import &quot;@/assets/scss/my-variables&quot;;



// $props: (
//   width: (
//     name: &quot;width&quot;,
//     default:50vw,
//   ),
//   max-width:(
//     name: &quot;max-width&quot;,
//   ),
//   min-width:(
//     name: &quot;min-width&quot;,
//   ),
//   height:(
//     name: &quot;height&quot;,
//   ),
//   max-height:(
//     name: &quot;max-height&quot;,
//   ),
//   min-height:(
//     name: &quot;min-height&quot;,
    
//   ),

// );



.顧客登入表單 {

  background: #ffffff;
  padding: 24px;
  border-radius: 8px;
  box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
  width: 320px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}


.標題框 {
  text-align: center;
}

.標題 {
  font-size: 20px;
  color: #333;
  margin: 0;
}

.電子郵件框,
.密碼框,
.記住我框 {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.電子郵件-標籤,
.密碼-標籤,
.記住我-標籤 {
  font-size: 14px;
  color: #333;
}

.電子郵件-輸入,
.密碼-輸入 {
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
  width: 100%;
  box-sizing: border-box;
}


.記住我框 {
  flex-direction: row;
  align-items: center;
  gap: 6px;
}

.記住我-勾選 {
  width: 16px;
  height: 16px;
}


.登入註冊框 {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 8px;
}

.登入按鈕 {
  background-color: #007bff;
  color: white;
  border: none;
  padding: 10px 16px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}


.登入按鈕.等待 {
  visibility:hidden;
}


.登入按鈕:hover {
  background-color: #0056b3;
}

.註冊連結 {
  font-size: 14px;
  color: #007bff;
  cursor: pointer;
  text-decoration: none;
}

.註冊連結:hover {
  text-decoration: underline;
}



.密碼輸入框 {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  max-width: 300px;
  border: 1px solid #ccc;
  border-radius: 5px;
  padding: 5px;
  background: white;
}

.顯示密碼-按鈕{
    background: none;
    border: none;
    cursor: pointer;
    padding: 5px;
}

.顯示密碼-圖標{
    width: 20px;
    height: 20px;
    font-size: 16px;
    color: #666;
}

.visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

// Forgot Password Styles
.忘記密碼框 {
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 16px;
    background-color: #f9f9f9;
    border-radius: 6px;
    border: 1px solid #e0e0e0;
}

.忘記密碼-標籤 {
    font-size: 14px;
    color: #333;
}

.忘記密碼-輸入 {
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 14px;
    width: 100%;
    box-sizing: border-box;
}

.忘記密碼-訊息 {
    font-size: 13px;
    padding: 8px 12px;
    border-radius: 4px;
}

.忘記密碼-訊息.成功 {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.忘記密碼-訊息.錯誤 {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.忘記密碼-送出按鈕 {
    background-color: #28a745;
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.2s;
}

.忘記密碼-送出按鈕:hover:not(:disabled) {
    background-color: #218838;
}

.忘記密碼-送出按鈕:disabled {
    background-color: #6c757d;
    cursor: not-allowed;
}

.連結框 {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 8px;
}

.忘記密碼連結 {
    font-size: 14px;
    color: #007bff;
    cursor: pointer;
    text-decoration: none;
    background: none;
    border: none;
    padding: 0;
}

.忘記密碼連結:hover {
    text-decoration: underline;
}</pre>
</body>
</html>